/*! monex v0.9.18-SNAPSHOT | (c) 2019  | LGPL-2.1-only License | git+https://github.com/eXist-db/monex.git */
var RemoteConsole=(function(){var n,o="default";return{connect:function(){var e=location.pathname.slice(0,location.pathname.indexOf("/apps")),t=("https:"===window.location.protocol?"wss":"ws")+"://"+location.host+e+"/rconsole";(n=new WebSocket(t)).onerror=function(e){$("#status").text("Connection error ..."),console.log("WebSocket Error: %o",e)},n.onclose=function(){$("#status").text("Disconnected.")},n.onopen=function(){$("#status").text("Connected."),n.send('{ "channel": "'+o+'" }')},n.onmessage=function(e){if("ping"!==e.data){$(".note").hide(300);var t=JSON.parse(e.data),n=$("#console tr");50<=n.length&&n.get(0).remove();var o=t.timestamp.replace(/^.*T([^+]+).*$/,"$1"),a=document.createElement("tr");a.style.display="none",a.className="message";var c=document.createElement("td");if(c.className="hidden-xs",c.appendChild(document.createTextNode(o)),a.appendChild(c),(c=document.createElement("td")).className="hidden-xs",t.source){var l=t.source.replace(/^.*\/([^/]+)$/,"$1");c.appendChild(document.createTextNode(l))}else c.appendChild(document.createTextNode("unknown"));if(a.appendChild(c),(c=document.createElement("td")).className="hidden-xs",t.line?c.appendChild(document.createTextNode(t.line+" / "+t.column)):c.appendChild(document.createTextNode("- / -")),a.appendChild(c),(c=document.createElement("td")).className="message",t.json){var d=JSON.parse(t.message),s=document.createElement("dl");for(var r in s.className="dl-horizontal",d){var i=document.createElement("dt");i.appendChild(document.createTextNode("$"+r)),s.appendChild(i);var m=document.createElement("dd");m.appendChild(document.createTextNode(d[r])),s.appendChild(m)}c.appendChild(s)}else c.appendChild(document.createTextNode(t.message));a.appendChild(c),(c=document.createElement("td")).className="source";var p=document.createElement("button");p.type="button",p.className="btn btn-default";var u=document.createElement("span");u.className="fa fa-info",p.appendChild(u),c.appendChild(p),p.setAttribute("data-toggle","tooltip"),p.title=t.timestamp+": "+t.source+" ["+t.line+" / "+t.column+"]",$(p).tooltip({placement:"left",trigger:"click"}),a.appendChild(c),$("#console").append(a),$(a).show(200,(function(){this.scrollIntoView()}))}}},clear:function(){$("#console .message").remove(),$("#console .note").show()},showMessage:function(e){var t=document.createElement("tr");t.className="message";var n=document.createElement("td");n.setAttribute("colspan",5),n.appendChild(document.createTextNode(e)),t.appendChild(n),$("#console").append(t)},setChannel:function(e){o=e||"default",n.send('{ "channel": "'+o+'" }'),RemoteConsole.showMessage("Channel switched to '"+o+"'.")},saveState:function(){Modernizr.localstorage&&(localStorage["monex.channel"]=o)},restoreState:function(){Modernizr.localstorage&&(o=localStorage["monex.channel"]||"default",$("input[name='channel']").val(o))}}})();$(document).ready((function(){RemoteConsole.restoreState(),RemoteConsole.connect(),$("#clear").click((function(e){e.preventDefault(),RemoteConsole.clear()})),$("#set-channel").click((function(e){e.preventDefault();var t=$("input[name='channel']").val();RemoteConsole.setChannel(t)})),$(window).unload((function(){RemoteConsole.saveState()}))}));